---
import Layout from '../layouts/Layout.astro';
import { getCollection } from 'astro:content';

const docs = await getCollection('docs');
const blogs = await getCollection('blogs');

const sidebarItems = [
  ...docs.map((d) => {
    const s = d.id.replace(/\.md$/, '');
    return { href: `/docs/${s}`, label: d.data.title ?? s, active: false };
  }),
  ...blogs.map((b) => {
    const s = b.id.replace(/\.md$/, '');
    return { href: `/blogs/${s}`, label: b.data.title ?? s, active: false };
  }),
];
---

<Layout title="OpenStoat" sidebarItems={sidebarItems} currentSection="home">
  <div class="prose dark:prose-invert max-w-none" style="color: var(--pixel-fg);">
    <div class="mb-12">
      <h1 class="text-3xl font-pixel tracking-tight" style="color: var(--pixel-fg);">OpenStoat</h1>
      <p class="text-xl mt-2" style="color: var(--pixel-muted);">
        Agent-first AI and Human collaborative task orchestration system.
      </p>
      <p class="mt-4" style="color: var(--pixel-muted);">
        Local-first, CLI-first. No account or API key required. OpenStoat orchestrates tasks between AI agents and humansâ€”agents execute by default, humans join when needed.
      </p>
      <div class="install-block not-prose mt-6 relative">
        <div
          id="install-cmd"
          class="install-cmd overflow-x-auto px-5 py-4 pr-14 font-pixel border-2 border-[var(--pixel-border)] bg-[var(--pixel-hover-bg)] text-[var(--pixel-fg)] text-left"
          style="box-shadow: 4px 4px 0 var(--pixel-border);"
        >
          npm install openstoat
        </div>
        <button
          type="button"
          id="install-copy-btn"
          class="absolute top-3 right-3 p-2 border-2 border-[var(--pixel-border)] bg-[var(--pixel-bg)] text-[var(--pixel-fg)] hover:bg-[var(--pixel-hover-bg)] transition font-pixel text-xs"
          aria-label="Copy to clipboard"
          title="Copy"
        >
          <span id="install-copy-text">Copy</span>
        </button>
      </div>
      <script>
        document.getElementById('install-copy-btn')?.addEventListener('click', async function () {
          const text = (document.getElementById('install-cmd')?.textContent ?? '').trim();
          const label = document.getElementById('install-copy-text');
          try {
            await navigator.clipboard.writeText(text);
            if (label) {
              label.textContent = 'Copied!';
              setTimeout(() => (label.textContent = 'Copy'), 2000);
            }
          } catch {
            if (label) label.textContent = 'Failed';
          }
        });
      </script>
      <div class="flex gap-4 mt-6 not-prose">
        <a
          href="/docs"
          class="btn-filled inline-flex items-center px-4 py-2 font-pixel text-xs border-2 border-[var(--pixel-border)] bg-[var(--pixel-fg)] text-[var(--pixel-bg)] hover:opacity-90 transition"
          style="box-shadow: 4px 4px 0 var(--pixel-border);"
        >
          Documentation
        </a>
        <a
          href="/blogs"
          class="inline-flex items-center px-4 py-2 font-pixel text-xs border-2 border-[var(--pixel-border)] hover:bg-[var(--pixel-hover-bg)] transition"
        >
          Blog
        </a>
      </div>
    </div>
    <section>
      <h2 class="font-pixel text-lg" style="color: var(--pixel-fg);">Quick Links</h2>
      <div class="grid gap-6 sm:grid-cols-2 not-prose mt-4">
        <a
          href="/docs"
          class="block p-4 border-2 border-[var(--pixel-border)] hover:bg-[var(--pixel-hover-bg)] transition"
          style="box-shadow: 4px 4px 0 var(--pixel-border);"
        >
          <h3 class="font-pixel text-xs" style="color: var(--pixel-fg);">Documentation</h3>
          <p class="text-sm mt-1 font-pixel-body" style="color: var(--pixel-muted);">
            Product spec, architecture, use cases, and development guides.
          </p>
        </a>
        <a
          href="/blogs"
          class="block p-4 border-2 border-[var(--pixel-border)] hover:bg-[var(--pixel-hover-bg)] transition"
          style="box-shadow: 4px 4px 0 var(--pixel-border);"
        >
          <h3 class="font-pixel text-xs" style="color: var(--pixel-fg);">Blog</h3>
          <p class="text-sm mt-1 font-pixel-body" style="color: var(--pixel-muted);">
            Stories, updates, and insights about OpenStoat.
          </p>
        </a>
        <a
          href="/dashboard/risk"
          class="block p-4 border-2 border-[var(--pixel-border)] hover:bg-[var(--pixel-hover-bg)] transition"
          style="box-shadow: 4px 4px 0 var(--pixel-border);"
        >
          <h3 class="font-pixel text-xs" style="color: var(--pixel-fg);">Risk Dashboard</h3>
          <p class="text-sm mt-1 font-pixel-body" style="color: var(--pixel-muted);">
            Block rate, false positive rate, provider error rate, whitelist hit rate from BigQuery.
          </p>
        </a>
      </div>
    </section>
  </div>
</Layout>
