---
import Layout from '../../layouts/Layout.astro';
import { getCollection } from 'astro:content';

const docs = await getCollection('docs');
const blogs = await getCollection('blogs');

const sortedBlogs = [...blogs].sort((a, b) => {
  const dateA = a.data.publishDate ? new Date(a.data.publishDate).getTime() : 0;
  const dateB = b.data.publishDate ? new Date(b.data.publishDate).getTime() : 0;
  return dateB - dateA;
});

const sidebarItems = [
  ...docs.map((d) => {
    const s = d.id.replace(/\.md$/, '');
    return { href: `/docs/${s}`, label: d.data.title ?? s, active: false };
  }),
  ...blogs.map((b) => {
    const s = b.id.replace(/\.md$/, '');
    return { href: `/blogs/${s}`, label: b.data.title ?? s, active: false };
  }),
];
---

<Layout title="Blog" sidebarItems={sidebarItems} currentSection="blogs">
  <div class="prose dark:prose-invert max-w-none">
    <h1>Blog</h1>
    <p class="text-slate-600 dark:text-slate-400">
      Stories, updates, and insights about OpenStoat.
    </p>
    <h2>Posts</h2>
    <ul class="space-y-2">
      {sortedBlogs.map((b) => {
        const s = b.id.replace(/\.md$/, '');
        const dateStr = b.data.publishDate ? new Date(b.data.publishDate).toLocaleDateString('en-US', { year: 'numeric', month: 'short', day: 'numeric' }) : null;
        return (
          <li>
            <a href={`/blogs/${s}`} class="text-blue-600 dark:text-blue-400 hover:underline font-medium">
              {b.data.title ?? s}
            </a>
            {dateStr && <span class="text-slate-500 dark:text-slate-400 text-sm ml-2">â€” {dateStr}</span>}
          </li>
        );
      })}
    </ul>
  </div>
</Layout>
