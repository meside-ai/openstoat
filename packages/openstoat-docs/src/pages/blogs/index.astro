---
import Layout from '../../layouts/Layout.astro';
import { getCollection } from 'astro:content';

const docs = await getCollection('docs');
const blogs = await getCollection('blogs');

const sortedBlogs = [...blogs].sort((a, b) => {
  const dateA = a.data.publishDate ? new Date(a.data.publishDate).getTime() : 0;
  const dateB = b.data.publishDate ? new Date(b.data.publishDate).getTime() : 0;
  return dateB - dateA;
});

const sidebarItems = [
  ...docs.map((d) => {
    const s = d.id.replace(/\.md$/, '');
    return { href: `/docs/${s}`, label: d.data.title ?? s, active: false };
  }),
  ...blogs.map((b) => {
    const s = b.id.replace(/\.md$/, '');
    return { href: `/blogs/${s}`, label: b.data.title ?? s, active: false };
  }),
];
---

<Layout title="Blog" sidebarItems={sidebarItems} currentSection="blogs">
  <div class="prose dark:prose-invert max-w-none" style="color: var(--pixel-fg);">
    <h1 class="font-pixel text-lg" style="color: var(--pixel-fg);">Blog</h1>
    <p class="font-pixel-body" style="color: var(--pixel-muted);">
      Stories, updates, and insights about OpenStoat.
    </p>
    <h2 class="font-pixel text-sm mt-6" style="color: var(--pixel-fg);">Posts</h2>
    <ul class="space-y-2 mt-4">
      {sortedBlogs.map((b) => {
        const s = b.id.replace(/\.md$/, '');
        const dateStr = b.data.publishDate ? new Date(b.data.publishDate).toLocaleDateString('en-US', { year: 'numeric', month: 'short', day: 'numeric' }) : null;
        return (
          <li>
            <a
              href={`/blogs/${s}`}
              class="font-pixel-body underline hover:no-underline transition"
              style="color: var(--pixel-fg); text-underline-offset: 4px;"
            >
              {b.data.title ?? s}
            </a>
            {dateStr && <span class="font-pixel-body text-sm ml-2" style="color: var(--pixel-muted);">â€” {dateStr}</span>}
          </li>
        );
      })}
    </ul>
  </div>
</Layout>
