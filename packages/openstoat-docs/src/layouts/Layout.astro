---
import '../styles/global.css';

interface Props {
  title: string;
  sidebarItems: { href: string; label: string; active?: boolean }[];
  currentSection: 'home' | 'docs' | 'blogs';
  /** Override main content max-width (e.g. "max-w-7xl" for doc pages with TOC) */
  contentClass?: string;
}

const { title, sidebarItems, currentSection, contentClass = 'max-w-4xl' } = Astro.props;
---

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="generator" content={Astro.generator} />
    <title>{title} - OpenStoat</title>
    <link href="https://fonts.googleapis.com/css2?family=Pixelify+Sans:wght@400;500;600;700&family=Press+Start+2P&display=swap" rel="stylesheet" />
  </head>
  <body class="font-sans bg-white text-black min-h-screen" style="image-rendering: pixelated; image-rendering: crisp-edges;">
    <div class="flex min-h-screen">
      <aside
        id="sidebar"
        class="fixed lg:static inset-y-0 left-0 z-40 w-64 bg-[#f5f5f5] border-r-2 border-black transform -translate-x-full lg:translate-x-0 transition-transform duration-200 ease-in-out"
      >
        <div class="flex flex-col h-full">
          <div class="flex items-center justify-between p-4 border-b-2 border-black">
            <a href="/" class="text-lg font-semibold text-black">openstoat</a>
            <button
              id="sidebar-close"
              class="lg:hidden p-2 border-2 border-black hover:bg-black hover:text-white"
              aria-label="Close menu"
            >
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
              </svg>
            </button>
          </div>
          <nav class="flex-1 overflow-y-auto p-4">
            <ul class="space-y-1">
              <li>
                <a
                  href="/"
                  class={`block px-3 py-2 border-2 border-transparent ${currentSection === 'home' ? 'bg-black text-white border-black' : 'hover:bg-black hover:text-white border-black'}`}
                >
                  Home
                </a>
              </li>
              <li class="pt-2">
                <span class="px-3 text-xs font-semibold text-[#404040] uppercase"
                  >Documentation</span
                >
              </li>
              <li>
                <a
                  href="/docs"
                  class={`block px-3 py-2 border-2 border-transparent ${currentSection === 'docs' ? 'bg-black text-white border-black' : 'hover:bg-black hover:text-white border-black'}`}
                >
                  Docs
                </a>
              </li>
              {sidebarItems
                .filter((i) => i.href.startsWith('/docs/'))
                .map((i) => (
                  <li>
                    <a
                      href={i.href}
                      class={`block px-3 py-2 text-sm border-2 border-transparent ${i.active ? 'bg-black text-white font-medium border-black' : 'hover:bg-black hover:text-white border-black'}`}
                    >
                      {i.label}
                    </a>
                  </li>
                ))}
              <li class="pt-2">
                <span class="px-3 text-xs font-semibold text-[#404040] uppercase">Blog</span>
              </li>
              <li>
                <a
                  href="/blogs"
                  class={`block px-3 py-2 border-2 border-transparent ${currentSection === 'blogs' ? 'bg-black text-white border-black' : 'hover:bg-black hover:text-white border-black'}`}
                >
                  Blogs
                </a>
              </li>
              {sidebarItems
                .filter((i) => i.href.startsWith('/blogs/'))
                .map((i) => (
                  <li>
                    <a
                      href={i.href}
                      class={`block px-3 py-2 text-sm border-2 border-transparent ${i.active ? 'bg-black text-white font-medium border-black' : 'hover:bg-black hover:text-white border-black'}`}
                    >
                      {i.label}
                    </a>
                  </li>
                ))}
            </ul>
          </nav>
        </div>
      </aside>
      <div id="sidebar-overlay" class="fixed inset-0 bg-black/50 z-30 lg:hidden hidden" aria-hidden="true"></div>
      <div class="flex-1 flex flex-col min-w-0">
        <header
          class="sticky top-0 z-20 flex items-center justify-between px-4 py-3 bg-white backdrop-blur border-b-2 border-black"
        >
          <button
            id="sidebar-toggle"
            class="lg:hidden p-2 border-2 border-black hover:bg-black hover:text-white"
            aria-label="Open menu"
          >
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
            </svg>
          </button>
          <div class="flex-1"></div>
        </header>
        <main class={`flex-1 p-6 lg:p-8 ${contentClass} mx-auto w-full`}>
          <slot />
        </main>
      </div>
    </div>
    <script>
      (function () {
        function openSidebar() {
          document.getElementById('sidebar')?.classList.remove('-translate-x-full');
          document.getElementById('sidebar-overlay')?.classList.remove('hidden');
        }
        function closeSidebar() {
          document.getElementById('sidebar')?.classList.add('-translate-x-full');
          document.getElementById('sidebar-overlay')?.classList.add('hidden');
        }
        document.getElementById('sidebar-toggle')?.addEventListener('click', openSidebar);
        document.getElementById('sidebar-close')?.addEventListener('click', closeSidebar);
        document.getElementById('sidebar-overlay')?.addEventListener('click', closeSidebar);
      })();
    </script>
  </body>
</html>
