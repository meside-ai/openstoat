---
import '../styles/global.css';

interface Props {
  title: string;
  sidebarItems: { href: string; label: string; active?: boolean }[];
  currentSection: 'home' | 'docs' | 'blogs';
  /** Override main content max-width (e.g. "max-w-7xl" for doc pages with TOC) */
  contentClass?: string;
}

const { title, sidebarItems, currentSection, contentClass = 'max-w-4xl' } = Astro.props;
---

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="generator" content={Astro.generator} />
    <title>{title} - OpenStoat</title>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=VT323&family=Pixelify+Sans:wght@400;500;600;700&display=swap" rel="stylesheet" />
  </head>
  <body class="font-pixel-body bg-[var(--pixel-bg)] text-[var(--pixel-fg)] min-h-screen" style="font-family: 'VT323', 'Pixelify Sans', 'Press Start 2P', monospace; -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale;">
    <div class="flex min-h-screen">
      <aside
        id="sidebar"
        class="fixed lg:static inset-y-0 left-0 z-40 w-64 bg-[var(--pixel-bg)] border-r-4 border-[var(--pixel-border)] transform -translate-x-full lg:translate-x-0 transition-transform duration-200 ease-out"
        style="box-shadow: 4px 0 0 var(--pixel-border);"
      >
        <div class="flex flex-col h-full">
          <div class="flex items-center justify-between p-4 border-b-4 border-[var(--pixel-border)]">
            <a href="/" class="text-sm font-pixel text-[var(--pixel-fg)]">openstoat</a>
            <button
              id="sidebar-close"
              class="lg:hidden p-2 rounded-none border-2 border-[var(--pixel-border)] hover:bg-[var(--pixel-hover-bg)]"
              aria-label="Close menu"
            >
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="square" stroke-linejoin="miter" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
              </svg>
            </button>
          </div>
          <nav class="flex-1 overflow-y-auto p-4">
            <ul class="space-y-1">
              <li>
                <a
                  href="/"
                  class={`block px-3 py-2 font-pixel text-xs ${currentSection === 'home' ? 'bg-[var(--pixel-hover-bg)] border-2 border-[var(--pixel-border)]' : 'hover:bg-[var(--pixel-hover-bg)] border-2 border-transparent hover:border-[var(--pixel-border)]'}`}
                >
                  Home
                </a>
              </li>
              <li class="pt-2">
                <span class="px-3 text-xs font-pixel text-[var(--pixel-muted)] uppercase">
                  Documentation</span
                >
              </li>
              <li>
                <a
                  href="/docs"
                  class={`block px-3 py-2 font-pixel text-xs ${currentSection === 'docs' ? 'bg-[var(--pixel-hover-bg)] border-2 border-[var(--pixel-border)]' : 'hover:bg-[var(--pixel-hover-bg)] border-2 border-transparent hover:border-[var(--pixel-border)]'}`}
                >
                  Docs
                </a>
              </li>
              {sidebarItems
                .filter((i) => i.href.startsWith('/docs/'))
                .map((i) => (
                  <li>
                    <a
                      href={i.href}
                      class={`block px-3 py-2 text-sm font-pixel-body ${i.active ? 'bg-[var(--pixel-hover-bg)] border-2 border-[var(--pixel-border)]' : 'hover:bg-[var(--pixel-hover-bg)] border-2 border-transparent hover:border-[var(--pixel-border)]'}`}
                    >
                      {i.label}
                    </a>
                  </li>
                ))}
              <li class="pt-2">
                <span class="px-3 text-xs font-pixel text-[var(--pixel-muted)] uppercase">Blog</span>
              </li>
              <li>
                <a
                  href="/blogs"
                  class={`block px-3 py-2 font-pixel text-xs ${currentSection === 'blogs' ? 'bg-[var(--pixel-hover-bg)] border-2 border-[var(--pixel-border)]' : 'hover:bg-[var(--pixel-hover-bg)] border-2 border-transparent hover:border-[var(--pixel-border)]'}`}
                >
                  Blogs
                </a>
              </li>
              {sidebarItems
                .filter((i) => i.href.startsWith('/blogs/'))
                .map((i) => (
                  <li>
                    <a
                      href={i.href}
                      class={`block px-3 py-2 text-sm font-pixel-body ${i.active ? 'bg-[var(--pixel-hover-bg)] border-2 border-[var(--pixel-border)]' : 'hover:bg-[var(--pixel-hover-bg)] border-2 border-transparent hover:border-[var(--pixel-border)]'}`}
                    >
                      {i.label}
                    </a>
                  </li>
                ))}
            </ul>
          </nav>
          <div class="p-4 border-t-4 border-[var(--pixel-border)]">
            <button
              id="theme-toggle"
              class="flex items-center gap-2 px-3 py-2 font-pixel text-xs border-2 border-[var(--pixel-border)] hover:bg-[var(--pixel-hover-bg)] w-full text-left"
              aria-label="Toggle dark mode"
            >
              <svg id="icon-sun" class="w-5 h-5 hidden dark:block" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path
                  stroke-linecap="square"
                  stroke-linejoin="miter"
                  stroke-width="2"
                  d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"
                />
              </svg>
              <svg id="icon-moon" class="w-5 h-5 block dark:hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path
                  stroke-linecap="square"
                  stroke-linejoin="miter"
                  stroke-width="2"
                  d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"
                />
              </svg>
              <span id="theme-label">Toggle theme</span>
            </button>
          </div>
        </div>
      </aside>
      <div id="sidebar-overlay" class="fixed inset-0 bg-black/50 z-30 lg:hidden hidden" aria-hidden="true"></div>
      <div class="flex-1 flex flex-col min-w-0">
        <header
          class="sticky top-0 z-20 flex items-center justify-between px-4 py-3 bg-[var(--pixel-bg)] border-b-4 border-[var(--pixel-border)]"
          style="box-shadow: 0 4px 0 var(--pixel-border);"
        >
          <button
            id="sidebar-toggle"
            class="lg:hidden p-2 border-2 border-[var(--pixel-border)] hover:bg-[var(--pixel-hover-bg)]"
            aria-label="Open menu"
          >
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="square" stroke-linejoin="miter" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
            </svg>
          </button>
          <div class="flex-1"></div>
        </header>
        <main class={`flex-1 p-6 lg:p-8 ${contentClass} mx-auto w-full`}>
          <slot />
        </main>
      </div>
    </div>
    <script>
      (function () {
        const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
        const stored = localStorage.getItem('theme');
        const dark = stored === 'dark' || (!stored && prefersDark);
        if (dark) document.documentElement.classList.add('dark');
        else document.documentElement.classList.remove('dark');

        document.getElementById('theme-toggle')?.addEventListener('click', function () {
          document.documentElement.classList.toggle('dark');
          localStorage.setItem('theme', document.documentElement.classList.contains('dark') ? 'dark' : 'light');
        });

        function openSidebar() {
          document.getElementById('sidebar')?.classList.remove('-translate-x-full');
          document.getElementById('sidebar-overlay')?.classList.remove('hidden');
        }
        function closeSidebar() {
          document.getElementById('sidebar')?.classList.add('-translate-x-full');
          document.getElementById('sidebar-overlay')?.classList.add('hidden');
        }
        document.getElementById('sidebar-toggle')?.addEventListener('click', openSidebar);
        document.getElementById('sidebar-close')?.addEventListener('click', closeSidebar);
        document.getElementById('sidebar-overlay')?.addEventListener('click', closeSidebar);
      })();
    </script>
  </body>
</html>
